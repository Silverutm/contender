: include "headers/contest.tx"

: macro round -> $x { $x }

<article class="windows">
  <section>
    <header>
      <: $contest.name :>
      : if $contest_status {
      (<: $contest_status :>)
      : }
    </header>
    : if $pagecount > 1 {
    <ul class="paginator">
      <li><a href="/contest/<: $contest.id :>/windows/page/<: ($page - 1) max 1 :>" class="<: $page == 1? 'inactive': '' :>">&larr;</a></li>
      : for $pages -> $row {
      <li><a href="/contest/<: $contest.id :>/windows/page/<: $row :>" class="<: $row == $page? 'chosen': '' :>"><: $row :></a></li>
      : }
      <li><a href="/contest/<: $contest.id :>/windows/page/<: ($page + 1) min $pagecount :>" class="<: $page == $pagecount? 'inactive': '' :>">&rarr;</a></li>
    </ul>
    : }
    <table class="windows">
      <thead>
        <tr>
          <th>Name</th>
          <th>Start</th>
          <th>Progress</th>
          <th>State</th>
        </tr>
      </thead>
      <tbody>
        : for $windows -> $row {
        <tr>
          <td><img class="flag" src="/static/images/flags/uk-small.png"/><: $row.user_id.realname || $row.user_id.username:></td>
          <td><: $row.start_time.ymd :> <: $row.start_time.hms :></td>
          <td><meter value="<: $now.epoch - $row.start_time.epoch - 60 * 60 :>" min="0" max="<: $row.duration :>" title="<: round(($now.epoch - $row.start_time.epoch - 60 * 60) * 100 / ($row.duration max 1)) min 100 :>%"></meter></td>
          : if $now.epoch - $row.start_time.epoch - 60 * 60 <= $row.duration {
          <td class="running">Running</td>
          : } else {
          <td class="finished">Finished</td>
          : }
        </tr>
        : }
      </tbody>
    </table>
    <paper-shadow z-id="1" />
  </section>
</article>

: include "footers/contest.tx"
